/**
 * nunjucks can't pass object in onClick
 */
const data = require("../data/team.json");

const { members } = data;

const modalNode = document.getElementById("mc");
const modalBgNode = document.getElementById("mc-bg");
const modalContentNode = document.getElementById("mc-content");

const setModalActive = () => {
  // Prevent body scroll
  document.body.style.overflow = "hidden";
  modalNode.classList.add("active");
};

const handleCloseModal = e => {
  document.body.style.overflow = "visible";
  modalNode.classList.remove("active");

  setTimeout(() => {
    modalContentNode.innerHTML = "";
  }, 300);
};

window.handleCloseModal = handleCloseModal;

/**
 * Modal Control
 */

/**
 * @param {node} element
 */
const setModal = content => {
  setModalActive();
  modalContentNode.appendChild(content);
};

const urls = {
  linkedin: "https://www.linkedin.com/",
  twitter: "https://twitter.com/",
  github: "https://github.com/"
};

const icons = {
  linkedin: `<svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
          <g id="linkedin-logo" fill="#000000" fill-rule="nonzero">
              <path d="M16.6366357,0 L1.32732251,0 C0.59425058,0 8.35266821e-05,0.576041763 8.35266821e-05,1.28702088 L8.35266821e-05,16.6756009 C8.35266821e-05,17.3866218 0.594459397,17.9631647 1.32732251,17.9631647 L16.6366357,17.9631647 C17.3695406,17.9631647 17.9630394,17.3862459 17.9630394,16.6756009 L17.9630394,1.28702088 C17.9630394,0.57625058 17.3695406,0 16.6366357,0 Z M5.44593968,15.0363898 L2.73186543,15.0363898 L2.73186543,6.9262413 L5.44593968,6.9262413 L5.44593968,15.0363898 Z M4.08917401,5.81825986 L4.07092343,5.81825986 C3.16077494,5.81825986 2.57078422,5.19581903 2.57078422,4.41655684 C2.57078422,3.62159165 3.17810673,3.0160232 4.10629698,3.0160232 C5.03457077,3.0160232 5.60555916,3.62142459 5.62360093,4.41655684 C5.62360093,5.19598608 5.03477958,5.81825986 4.08917401,5.81825986 Z M15.2293782,15.0363898 L12.516181,15.0363898 L12.516181,10.6971787 C12.516181,9.60686311 12.1230626,8.86289095 11.1418747,8.86289095 C10.3912622,8.86289095 9.9456891,9.36480278 9.75002784,9.84938283 C9.67752668,10.0224501 9.65956845,10.2645104 9.65956845,10.5062367 L9.65956845,15.0362227 L6.94687239,15.0362227 C6.94687239,15.0362227 6.98237123,7.68675174 6.94687239,6.92611601 L9.65998608,6.92611601 L9.65998608,8.07590255 C10.0201531,7.52341531 10.663768,6.7352993 12.1045615,6.7352993 C13.8903619,6.7352993 15.2293782,7.89377262 15.2293782,10.386 L15.2293782,15.0363898 Z M9.65933411,8.14866752 C9.67043411,8.13046752 9.68593411,8.10856752 9.70133411,8.08726752 L9.70133411,8.14866752 L9.65933411,8.14866752 Z" id="LinkedIn__x28_alt_x29_"></path>
          </g>
      </g>
  </svg>`,
  twitter: `<svg width="18px" height="15px" viewBox="0 0 18 15" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
          <g id="twitter" fill="#000000">
              <path d="M17.9649825,1.76178947 C17.3039298,2.05491228 16.5936842,2.25305263 15.8481404,2.34214035 C16.6090526,1.886 17.1934737,1.1637193 17.4687018,0.303017544 C16.7564561,0.725438596 15.9677544,1.03214035 15.1281754,1.19740351 C14.4558947,0.481087719 13.4979649,0.0335438596 12.4378596,0.0335438596 C10.402386,0.0335438596 8.75217544,1.68368421 8.75217544,3.71912281 C8.75217544,4.008 8.78477193,4.28929825 8.84761404,4.55908772 C5.78445614,4.40533333 3.06863158,2.93803509 1.25080702,0.708105263 C0.93354386,1.25245614 0.751754386,1.88557895 0.751754386,2.56105263 C0.751754386,3.83978947 1.40242105,4.96792982 2.39140351,5.62887719 C1.78722807,5.6097193 1.21891228,5.44392982 0.722035088,5.16785965 C0.721684211,5.18322807 0.721684211,5.19866667 0.721684211,5.21421053 C0.721684211,6.99996491 1.99217544,8.48957895 3.67821053,8.82824561 C3.36898246,8.91242105 3.04333333,8.95761404 2.70719298,8.95761404 C2.46968421,8.95761404 2.23880702,8.93445614 2.0137193,8.89136842 C2.48277193,10.3555789 3.84389474,11.4213333 5.45673684,11.4509825 C4.19533333,12.439614 2.60610526,13.0287719 0.879263158,13.0287719 C0.581754386,13.0287719 0.288385965,13.0113684 3.50877193e-05,12.9771579 C1.63112281,14.0230175 3.56849123,14.633193 5.64989474,14.633193 C12.4292281,14.633193 16.1364912,9.01698246 16.1364912,4.14645614 C16.1364912,3.98666667 16.1328421,3.8277193 16.1257895,3.66961404 C16.846,3.15 17.4708772,2.50087719 17.9649825,1.76178947 Z" id="Path"></path>
          </g>
      </g>
  </svg>`,
  github: `<svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
          <g id="github-logo" fill="#000000">
              <path d="M16.775344,4.4927426 C15.9713713,3.11523007 14.8808337,2.02465148 13.5034442,1.22076082 C12.1258497,0.416829157 10.6219271,0.0149658314 8.99061048,0.0149658314 C7.35949886,0.0149658314 5.85508428,0.416952164 4.47777677,1.22076082 C3.10026424,2.02461048 2.00976765,3.11523007 1.20579499,4.4927426 C0.40194533,5.87021412 0,7.37442369 0,9.0053303 C0,10.9644191 0.571571754,12.726082 1.71500228,14.2907699 C2.85830979,15.8555809 4.33529385,16.938369 6.14583144,17.5392574 C6.35658314,17.5783736 6.51259681,17.550861 6.61403645,17.4574169 C6.71551708,17.3638497 6.7661959,17.2466651 6.7661959,17.1063554 C6.7661959,17.0829431 6.76418679,16.8723144 6.76029157,16.4742232 C6.75627335,16.0761321 6.75438724,15.7288428 6.75438724,15.4325194 L6.48512528,15.4790979 C6.31344875,15.5105467 6.09687472,15.5238724 5.83540319,15.5201002 C5.57405467,15.516451 5.3027426,15.4890615 5.02183599,15.4381367 C4.74080638,15.3876629 4.47941686,15.2706014 4.23746241,15.0871982 C3.99563098,14.903795 3.82395444,14.6637267 3.7224738,14.3673622 L3.6054123,14.0979772 C3.52738497,13.9186333 3.40454214,13.7194032 3.23671982,13.5010251 C3.06889749,13.2824419 2.89918907,13.1342597 2.72751253,13.0562323 L2.64554897,12.9975581 C2.59093394,12.9585649 2.54025513,12.9115353 2.49338952,12.8569613 C2.44656492,12.8023872 2.41150797,12.7477722 2.38809567,12.6930752 C2.36464237,12.6383371 2.38407745,12.5934396 2.44660592,12.5582187 C2.5091344,12.5229977 2.62213667,12.5058998 2.78610478,12.5058998 L3.02014579,12.5408747 C3.17624146,12.5721595 3.36932118,12.6656036 3.59963098,12.8217813 C3.82981777,12.977836 4.01904328,13.1807153 4.16734852,13.4303371 C4.3469385,13.7504009 4.56330752,13.9942825 4.81707062,14.1621048 C5.0706287,14.3299271 5.3262779,14.4136948 5.58377221,14.4136948 C5.84126651,14.4136948 6.06366287,14.3941777 6.25104328,14.3553485 C6.43821868,14.3163144 6.61383144,14.2576401 6.77779954,14.1796538 C6.84803645,13.6565467 7.03927107,13.2546834 7.35133941,12.9737768 C6.9065467,12.9270342 6.50665148,12.8566333 6.15144875,12.7630251 C5.79645103,12.6692938 5.42960364,12.5171754 5.05115262,12.3062597 C4.67249658,12.095631 4.35837813,11.8340774 4.10871526,11.5220501 C3.85901139,11.2098588 3.654082,10.8 3.49421412,10.2928428 C3.33426424,9.78548064 3.25426879,9.20021412 3.25426879,8.53687927 C3.25426879,7.5923918 3.56260592,6.78866515 4.17915718,6.12524829 C3.89033713,5.41517084 3.91760364,4.61915262 4.26103872,3.73727563 C4.4873713,3.66695672 4.82301595,3.71972665 5.26780866,3.8952574 C5.71268337,4.07087016 6.03840547,4.22130752 6.24530296,4.34603645 C6.45220046,4.47072437 6.61797267,4.57638724 6.7428656,4.662082 C7.46881093,4.45924374 8.21796355,4.3578041 8.99052847,4.3578041 C9.76309339,4.3578041 10.51241,4.45924374 11.2383964,4.662082 L11.6832301,4.3812574 C11.987426,4.19387699 12.3466469,4.02215945 12.7600319,3.86606378 C13.1736629,3.71005011 13.4899544,3.66707973 13.7085786,3.73739863 C14.0596401,4.61931663 14.0909248,5.41529385 13.8020228,6.1253713 C14.418533,6.78878815 14.7269932,7.59271982 14.7269932,8.53700228 C14.7269932,9.20033713 14.6467107,9.78744875 14.4870068,10.2987062 C14.3270979,10.8100456 14.1204055,11.2194943 13.8668474,11.5279134 C13.6130023,11.8362916 13.2968747,12.095795 12.9184237,12.3063827 C12.5398907,12.5171344 12.1729203,12.6692528 11.8179226,12.7629841 C11.4627608,12.8567153 11.0628656,12.9271572 10.6180729,12.9739818 C11.0237494,13.3250433 11.2266287,13.8791891 11.2266287,14.6361731 L11.2266287,17.1060273 C11.2266287,17.2463371 11.2754214,17.3634806 11.3730888,17.4570888 C11.4706333,17.550533 11.6246788,17.5780456 11.8354305,17.5388884 C13.6462141,16.938082 15.1231982,15.8552528 16.2664647,14.2904419 C17.4096082,12.725754 17.981385,10.9640911 17.981385,9.00500228 C17.9809749,7.37430068 17.5788246,5.87021412 16.775344,4.4927426 Z" id="Path"></path>
          </g>
      </g>
  </svg>`
};

const generateLinks = (data, keys) => {
  return keys
    .map(
      key =>
        !!data[key]
          ? `<span class="link">${icons[key]} <a target="_blank" href="${
              urls[key]
            }${data[key]}"><strong>${data[key]}</strong></a></span>`
          : ""
    )
    .join("");
};

setModalTeamMemberProfile = event => {
  event.preventDefault();
  const target = event.currentTarget;

  const id = target.getAttribute("data-member-id");
  const member = members[id];

  const wrapperNode = document.createElement("div");
  wrapperNode.classList.add("tm-modal");
  wrapperNode.classList.add("tm-modal__member");

  const links = generateLinks(member, ["twitter", "linkedin", "github"]);

  wrapperNode.innerHTML = `<button id="modal-close" onclick="handleCloseModal()">
  <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
          <g id="close" fill="#000000">
              <path d="M10.5855,8.99475 L17.6595,1.92075 C18.099,1.481625 18.099,0.769125 17.6595,0.33 C17.22,-0.1095 16.50825,-0.1095 16.06875,0.33 L8.99475,7.404 L1.920375,0.33 C1.480875,-0.1095 0.769125,-0.1095 0.329625,0.33 C-0.109875,0.769125 -0.109875,1.481625 0.329625,1.92075 L7.404,8.99475 L0.329625,16.06875 C-0.109875,16.507875 -0.109875,17.220375 0.329625,17.6595 C0.549375,17.878875 0.837375,17.98875 1.125,17.98875 C1.412625,17.98875 1.700625,17.878875 1.920375,17.659125 L8.99475,10.585125 L16.06875,17.659125 C16.2885,17.878875 16.5765,17.98875 16.864125,17.98875 C17.15175,17.98875 17.43975,17.878875 17.6595,17.659125 C18.099,17.22 18.099,16.5075 17.6595,16.068375 L10.5855,8.99475 Z" id="Path"></path>
          </g>
      </g>
  </svg></button>
    <img alt="[foto] {{fullName}}" src="https://insight.topmonks.com/avatar/${
      member.id
    }" onerror="this.onerror=null; this.src='/images/monk_logo.png'" />
    <div class="content">
      <strong>${member.name} ${member.surname}</strong>
      ${member.job_title ? `<span>${member.job_title}</span>` : ""}
      ${member.quote ? `<q>${member.quote}</q>` : ""}
      ${
        links.length > 0
          ? `<div class="links">
              ${links}
            </div>
          `
          : ""
      }
    </div>
  `;
  setModal(wrapperNode);
};

/**
 * Inits
 */

const initModal = () => {
  modalBgNode.addEventListener("click", handleCloseModal);
  const memberNodes = document.getElementsByClassName("tm-team__member");

  // html collection doesn't have forEach
  for (let i = 0; i < memberNodes.length; i += 1) {
    memberNodes[i].addEventListener("click", setModalTeamMemberProfile);
  }
};

initModal();
